<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css?family=Montserrat:400,800');
        @import url('https://fonts.googleapis.com/css2?family=Abel&display=swap');

        * {
            box-sizing: border-box;
        }

        body {
            background: rgb(28, 69, 98);
            background: linear-gradient(140deg, rgb(28, 69, 98) 7%, rgba(255,255,255,1) 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            font-family: 'Montserrat', sans-serif;
            height: 100vh;
            margin: -20px 0 50px;
        }

        h1 {
            font-weight: bold;
            margin: 0;
            color: white;
        }

        .error {
            color: red;
        }

        p {
            font-size: 14px;
            font-weight: 100;
            line-height: 20px;
            letter-spacing: 0.5px;
            margin: 20px 0 30px;
        }

        a {
            color: #ffffff;
            font-size: 14px;
            text-decoration: none;
            margin: 15px 0;
        }

        button {
            border-radius: 20px;
            border: 1px solid rgb(28, 69, 98);
            background-color: rgb(28, 69, 98);
            color: #eeebeb;
            font-size: 10px;
            font-weight: bold;
            width: 300px;
            margin-top: 10px;
            padding: 12px 45px;
            letter-spacing: 1px;
            text-transform: uppercase;
            transition: transform 80ms ease-in;
        }

        form {
            background-color: rgba(255, 255, 255, 0.879);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            padding: 0 50px;
            height: 100%;
            border-radius: 30px;
            color: black;
        }

        input {
            background-color: rgb(247, 241, 241);
            border-radius: 15px;
            padding: 12px 15px;
            margin: 4px 0;
            width: 100%;
        }

        .container {
            background-color: #ffffffd3;
            border-radius: 30px;
            border-color: rgb(7, 7, 7);
            border: 2px solid;
            box-shadow: 0 14px 28px rgba(0,0,0,0.25), 0 10px 10px rgba(0,0,0,0.22);
            position: relative;
            overflow: hidden;
            height: 100px;
            width: 768px;
            max-width: 100%;
            min-height: 480px;
        }

        .form-container {
            position: absolute;
            top: 0;
            height: 100%;
        }

        .log-in-container {
            left: 0;
            width: 50%;
            z-index: 2;
        }

        .overlay-container {
            position: absolute;
            top: 0;
            left: 50%;
            width: 50%;
            height: 100%;
            transition: left 0.5s ease;
        }

        .overlay {
            background: rgb(28, 69, 98);
            color: #101010;
            position: relative;
            left: -100%;
            height: 100%;
            width: 200%;
        }

        .overlay-panel {
            position: absolute;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            padding: 0 40px;
            text-align: center;
            top: 0;
            height: 100%;
            width: 50%;
        }

        #ht {
            color: white;
        }

        #college {
            color: black;
        }

        #loginError {
            color: red;
        }

        .wave-container {
            position: absolute;
            top: 0;
            width: 100%;
            overflow: hidden;
            line-height: 0;
        }

        .wave-container svg {
            position: relative;
            display: block;
            width: 200%;
            height: 600px;
        }

        .wave-container .shape-fill {
            fill: rgba(28, 69, 98, 0.901);
        }
    </style>
</head>
<body>
    <div class="wave-container">
        <svg viewBox="0 0 1200 120" preserveAspectRatio="none">
            <path d="M0,0V46.29c47.92,22.39,100.88,35.68,153.81,42C279,99.56,351.8,86.31,400,68.67,512.14,29.05,645.47-8.5,748.71,3.72c117.24,13.87,246.66,61.54,339.81,98.06,58.83,23.69,106.48,36,111.48,37.67V0Z" class="shape-fill"></path>
        </svg>
    </div>
   
    <div class="container" id="container">
        <div class="form-container log-in-container">
            <form id="loginForm" action="#">
                <img src="/Users/hargundeepsingh/Downloads/cu.png" alt="" height="50px" width="80px">
                <h1 id="mtt">Login - Student</h1>
                <p id="college">Chitkara University Institute of Engineering & Technology</p>
                <input type="email" id="email" placeholder="Username" required />
                <input type="password" id="password" placeholder="Password" required />
                <input type="text" id="rollno" placeholder="Roll Number" required /> <!-- Changed to Roll Number -->
                <span id="loginError" class="error"></span>
                <button type="submit" id="bl" name="login">Log In</button>
            </form>
        </div>
        <div class="overlay-container" id="overlayContainer">
            <div class="overlay">
                <div class="overlay-panel overlay-right">
                    <h1 id="ht">Welcome to AcademiaPro</h1>
                </div>
            </div>
        </div>
    </div>
    
    <script src="https://kit.fontawesome.com/67ae9b72c4.js" crossorigin="anonymous"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-firestore-compat.js"></script>
    <script>
      // Firebase configuration
      const firebaseConfig = { 
    apiKey: "AIzaSyApEZByeoMNO_j88VSqFTBQ9dB7pepExWo",
    authDomain: "academiapro-692a4.firebaseapp.com",
    projectId: "academiapro-692a4",
    storageBucket: "academiapro-692a4.appspot.com",
    messagingSenderId: "634388116599",
    appId: "1:634388116599:web:92d9bd3ecbb325bf4b4272",
    measurementId: "G-7ZHQZYR9SX"
};
    
      // Initialize Firebase
      const app = firebase.initializeApp(firebaseConfig);
      const auth = firebase.auth();
      const db = firebase.firestore();
    
      document.getElementById("loginForm").addEventListener("submit", async (e) => {
          e.preventDefault();
          const email = document.getElementById("email").value;
          const password = document.getElementById("password").value;
          const rollno = document.getElementById("rollno").value;
          

          try {
              const userDoc = await db.collection('student').doc(rollno).get(); // Use roll number as doc ID
              if (userDoc.exists) {
    const userData = userDoc.data();
    if (userData.status === "approved") {
        const detailsCollection = await db.collection('students').doc(rollno).collection('details').get();
        if (detailsCollection) {
            // Redirect to homepage if the profile is complete
            window.location.href = "homepage.html";
        } else {
            // Redirect to profile page if the profile is incomplete
            window.location.href = "profile.html";
        }
                      localStorage.setItem('rollno', rollno);
                  } else if (userData.status === "rejected") {
                      alert("Your account has been rejected. Please contact the owner.");
                  } else {
                      alert("Your account is pending approval by an admin. Please wait for confirmation.");
                  }
              } else {
                  await db.collection('student').doc(rollno).set({
                      email: email,
                      rollno: rollno,
                      status: "pending"
                  });
                  alert("Your account is pending approval by an admin. Please wait for confirmation.");
              }
          } catch (error) {
              document.getElementById("loginError").textContent = error.message;
          }
      });

      async function loadPendingStudents() {
          const pendingStudentsContainer = document.getElementById("pendingStudents");
          const snapshot = await db.collection('student').where('status', '==', 'pending').get();
          snapshot.forEach(doc => {
              const data = doc.data();
              const studentDiv = document.createElement('div');
              studentDiv.textContent = `${data.email} - ${data.rollno}`;
              
              const approveButton = document.createElement('button');
              approveButton.textContent = "Approve";
              approveButton.onclick = () => approveStudent(doc.id, data.password);
      
              studentDiv.appendChild(approveButton);
              pendingStudentsContainer.appendChild(studentDiv);
          });
      }

      async function approveStudent(rollno, password) {
          try {
              const studentDoc = await db.collection('student').doc(rollno).get();
              if (studentDoc.exists) {
                  const email = studentDoc.data().email;
                  await auth.createUserWithEmailAndPassword(email, password);
                  await db.collection('student').doc(rollno).update({
                      status: "approved"
                  });
                  console.log("Student approved and added to Firebase Auth successfully");
              }
          } catch (error) {
              console.error("Error approving student:", error);
          }
      }
    </script>
</body>
</html>